<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ë§ ê¸°ì–µ ì˜ìˆ˜ì¦</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HTML to Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Barcode Generator -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* í°íŠ¸ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .receipt-font { font-family: 'Gowun Dodum', sans-serif; }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .bounce { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .print-animation {
            animation: printOutput 3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            transform-origin: top center;
        }
        @keyframes printOutput {
            0% { opacity: 0; transform: translateY(-150px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* ì˜ìˆ˜ì¦ ë””ìì¸ */
        .receipt-container {
            width: 380px;
            max-width: 90vw;
            min-height: 700px;
            background-color: #fff;
            margin: 0 auto;
            box-shadow: 0 25px 30px -5px rgba(0, 0, 0, 0.15);
            position: relative;
            /* ì—¬ë°± ìˆ˜ì •: í•˜ë‹¨ì„ ë„‰ë„‰í•˜ê²Œ 4rem(ì•½ 64px)ìœ¼ë¡œ ëŠ˜ë¦¼ */
            padding: 2rem 2rem 4rem 2rem;
            /* ì¢…ì´ ì§ˆê° */
            background-image: 
                linear-gradient(90deg, transparent 50%, rgba(200,200,200,.05) 50%),
                linear-gradient(0deg, transparent 0%, rgba(0,0,0,0.02) 50%);
            background-size: 4px 4px;
            background-repeat: repeat; /* ë°°ê²½ ë°˜ë³µ ëª…ì‹œ */
            margin-bottom: 50px;
        }

        /* ì°¢ì–´ì§„ ì¢…ì´ íš¨ê³¼ (ìƒ/í•˜ë‹¨) */
        .jagged-top, .jagged-bottom {
            position: absolute; left: 0; width: 100%; height: 15px;
            background-repeat: repeat-x; background-size: 20px 20px;
        }
        .jagged-top {
            top: -15px;
            background: linear-gradient(135deg, transparent 50%, #fff 50%), linear-gradient(225deg, transparent 50%, #fff 50%);
            filter: drop-shadow(0px -2px 2px rgba(0,0,0,0.05)); 
        }
        .jagged-bottom {
            bottom: -15px;
            background: linear-gradient(45deg, transparent 50%, #fff 50%), linear-gradient(-45deg, transparent 50%, #fff 50%);
            filter: drop-shadow(0px 5px 5px rgba(0,0,0,0.1));
        }

        /* ë°”ì½”ë“œ ì»¨í…Œì´ë„ˆ */
        .barcode {
            width: 100%; 
            margin-top: 15px; 
            opacity: 0.9; 
            display: flex;
            justify-content: center;
        }

        /* â˜… ê²°ì œì™„ë£Œ ë„ì¥ ì»¨í…Œì´ë„ˆ (SVGìš©) â˜… */
        .stamp-container {
            position: absolute; 
            top: 0px; 
            left: 210px; /* ìš”ì²­í•˜ì‹  ìœ„ì¹˜ */
            width: 90px;
            height: 36px;
            
            transform: rotate(-12deg);
            opacity: 0.8; 
            pointer-events: none; 
            mix-blend-mode: multiply;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- â–  1. ì…ë ¥ í™”ë©´ (INPUT SCREEN) â–  -->
    <div id="inputScreen" class="w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col h-[90vh] fade-in relative border border-gray-200">
        
        <div class="absolute top-3 right-4 text-[10px] text-gray-400 font-light z-20">
            @sorissaem
        </div>

        <div class="bg-gray-900 text-white p-6 flex-shrink-0">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-pen-nib text-yellow-400"></i> <span class="current-year-text"></span> ê¸°ì–µ ì˜ìˆ˜ì¦
            </h1>
            <p class="text-xs text-gray-400 mt-1 opacity-80">12ê°œì˜ ì§ˆë¬¸ìœ¼ë¡œ 1ë…„ì„ ì •ì‚°í•´ë³´ì„¸ìš”.</p>
        </div>

        <div class="flex-grow overflow-y-auto p-6 bg-gray-50">
            <div class="mb-6 bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                <label class="block text-xs font-bold text-gray-500 mb-2 uppercase tracking-wider">ë°œê¸‰ì (ì´ë¦„)</label>
                <input type="text" id="issuerName" class="w-full bg-white border-2 border-gray-200 rounded-lg p-3 text-sm focus:border-[#2C405E] focus:outline-none transition font-bold text-gray-800" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <!-- ì…ë ¥ í•„ë“œ ìƒì„± ì˜ì—­ -->
            <div id="inputContainer" class="space-y-4"></div>
            
            <div class="mt-8 text-center pb-4 text-gray-400 text-xs">
                 12ê°œë¥¼ ë‹¤ ì±„ìš°ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”.<br>ë¹„ì›Œë‘ë©´ ì˜ìˆ˜ì¦ì— ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </div>
        </div>

        <div class="p-4 border-t bg-white flex-shrink-0">
            <!-- ì €ì¥ ë²„íŠ¼: Regatta -->
            <button onclick="startIssueProcess()" class="w-full bg-[#2C405E] text-white py-4 rounded-xl font-bold hover:bg-[#1f2333] transition shadow-lg flex justify-center items-center gap-2 text-lg transform active:scale-95 duration-100">
                <span>ğŸ§¾ ì˜ìˆ˜ì¦ ë°œê¸‰í•˜ê¸°</span> 
            </button>
        </div>
    </div>


    <!-- â–  2. ë¡œë”© í™”ë©´ (LOADING SCREEN) â–  -->
    <div id="loadingScreen" class="hidden fixed inset-0 bg-[#2C405E] z-50 flex-col items-center justify-center text-white text-center p-8">
        <div class="text-6xl mb-6 bounce">â³</div>
        <h2 class="text-2xl font-bold mb-4">ì˜ìˆ˜ì¦ ë°œê¸‰ ì¤‘...</h2>
        <div class="space-y-2 text-gray-300 text-sm font-light">
            <!-- ì²´í¬/ë§‰ëŒ€: Soft Green -->
            <p><i class="fas fa-check text-[#4ADE80] mr-2"></i>ê¸°ì–µ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</p>
            <p id="loadingMsg2" class="opacity-0 transition-opacity duration-500"><i class="fas fa-check text-[#4ADE80] mr-2"></i>ì¶”ì–µ ì •ì‚° ì²˜ë¦¬ ì¤‘...</p>
            <p id="loadingMsg3" class="opacity-0 transition-opacity duration-1000"><i class="fas fa-check text-[#4ADE80] mr-2"></i><span class="current-year-text"></span>ë…„ ê²°ì œ ìŠ¹ì¸...</p>
        </div>
        <div class="mt-8 w-64 bg-gray-600 rounded-full h-2 overflow-hidden mx-auto">
            <div id="progressBar" class="bg-[#4ADE80] h-full w-0 transition-all duration-[4000ms] ease-out"></div>
        </div>
    </div>


    <!-- â–  3. ê²°ê³¼ í™”ë©´ (RESULT SCREEN) â–  -->
    <div id="resultScreen" class="hidden w-full max-w-lg h-[90vh] flex-col items-center fade-in">
        
        <div class="w-full flex justify-between items-center mb-4 px-2">
            <button onclick="goBack()" class="text-[#2C405E] font-bold text-sm bg-white px-4 py-2 rounded-full shadow-sm hover:bg-gray-100 transition">
                <i class="fas fa-arrow-left mr-1"></i> ìˆ˜ì •í•˜ê¸°
            </button>
            <span class="text-gray-300 text-xs bg-gray-100 px-2 py-1 rounded">@sorissaem</span>
        </div>

        <div class="flex-grow w-full overflow-y-auto custom-scroll flex justify-center items-start pb-10">
            <!-- h-fit ì¶”ê°€í•˜ì—¬ ë‚´ìš©ë§Œí¼ ëŠ˜ì–´ë‚˜ê²Œ í•¨ -->
            <div id="captureArea" class="receipt-container h-fit receipt-font text-gray-800 flex flex-col">
                <div class="jagged-top"></div>
                
                <!-- ì˜ìˆ˜ì¦ í—¤ë” -->
                <div class="text-center mb-1 pb-0 relative">
                    <!-- whitespace-nowrap ì¶”ê°€ë¡œ ì¤„ë°”ê¿ˆ ë°©ì§€ -->
                    <div class="text-xl sm:text-2xl font-black tracking-widest mb-2 text-gray-900 whitespace-nowrap">[ <span class="current-year-text"></span>ë…„ ê²°ì‚° ì˜ìˆ˜ì¦ ]</div>
                    <div class="text-[11px] font-bold text-gray-500 mb-6">ì†Œì¤‘í•œ 1ë…„ì´ ì •ìƒì ìœ¼ë¡œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
                    
                    <div class="flex justify-between text-xs font-bold px-1 text-gray-600 mb-1 w-full">
                        <span class="text-left">ê³ ê°ëª…: <span id="viewName" class="text-black text-sm"></span></span>
                        <span class="text-right">ë°œí–‰ì¼: <span id="receiptDate"></span></span>
                    </div>
                </div>

                <!-- ì˜ìˆ˜ì¦ ë¦¬ìŠ¤íŠ¸ -->
                <div class="flex-grow pb-6"> 
                    <div class="flex justify-between text-[11px] font-black border-b-2 border-black pb-2 mb-3 px-1 text-gray-700 mt-0">
                        <span class="w-[45%]">í’ˆëª© (ì£¼ì œ)</span>
                        <span class="w-[55%] text-right">ìƒì„¸ ë‚´ì—­ (ê¸°ì–µ)</span>
                    </div>
                    <div id="receiptList" class="space-y-3 text-sm px-1"></div>
                </div>

                <!-- ì˜ìˆ˜ì¦ í‘¸í„° -->
                <div class="mt-auto border-t-2 border-dashed border-gray-300 pt-5 text-center relative">
                    <div class="flex justify-between text-lg font-black mb-8 px-1 relative z-0">
                        <span>ì´ ê¸°ì–µ í•©ê³„</span>
                        <span><span id="totalCount">0</span> ê±´</span>

                        <!-- â˜… SVG ë„ì¥ (ì™„ì „ ê³ ì •í˜•, ì—°í•œ í•‘í¬ ë°°ê²½ í¬í•¨) â˜… -->
                        <div class="stamp-container">
                            <svg width="100%" height="100%" viewBox="0 0 90 36" xmlns="http://www.w3.org/2000/svg">
                                <!-- í…Œë‘ë¦¬ ë° ë°°ê²½ -->
                                <rect x="2" y="2" width="86" height="32" rx="4" ry="4" 
                                      fill="rgba(220, 38, 38, 0.05)" stroke="#dc2626" stroke-width="2.5" />
                                <!-- í…ìŠ¤íŠ¸ (Noto Sans KR, Black Weight) -->
                                <text x="50%" y="55%" 
                                      dominant-baseline="middle" text-anchor="middle" 
                                      fill="#dc2626" font-family="'Noto Sans KR', sans-serif" 
                                      font-weight="900" font-size="15">ê²°ì œì™„ë£Œ</text>
                            </svg>
                        </div>
                    </div>

                    <div class="mb-5 px-4">
                        <p id="quoteArea" class="text-xs text-gray-600 leading-relaxed font-bold break-keep"></p>
                    </div>
                    <div class="text-[9px] text-gray-400 tracking-tight leading-relaxed">
                        * ì´ë¯¸ ì‚¬ìš©í•˜ì‹  <span class="current-year-text"></span>ë…„ì€ ë°˜í’ˆì´ ë¶ˆê°€í•©ë‹ˆë‹¤.<br>
                        * ê³ ê°ë‹˜ì˜ ì†Œì¤‘í•œ ì¶”ì–µì€ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤.
                    </div>
                    
                    <!-- ë°”ì½”ë“œ -->
                    <div class="barcode flex justify-center items-center">
                        <svg id="barcodeSVG"></svg>
                    </div>
                    <div class="text-[12px] font-mono font-bold tracking-[0.1em] mt-1 text-gray-700">
                        ğŸ‰ HAPPY NEW YEAR âœ¨
                    </div>
                </div>
                <div class="jagged-bottom"></div>
            </div>
        </div>

        <div class="w-full p-4 flex gap-3">
            <!-- ì €ì¥í•˜ê¸°: Regatta (#2C405E) -->
            <button onclick="downloadImage()" class="flex-1 bg-[#2C405E] text-white py-4 rounded-xl font-bold hover:bg-[#1f2333] transition shadow-lg flex justify-center items-center gap-2 text-lg transform active:scale-95 duration-200">
                <i class="fas fa-save"></i> <span>ì €ì¥í•˜ê¸°</span>
            </button>
            <!-- ë§í¬ ê³µìœ í•˜ê¸°: Fresh Yellow (#FACC15) -->
            <button onclick="shareLink()" class="flex-1 bg-[#FACC15] text-gray-900 py-4 rounded-xl font-bold hover:bg-[#EAB308] transition shadow-lg flex justify-center items-center gap-2 text-lg transform active:scale-95 duration-200">
                <i class="fas fa-link"></i> <span>ë§í¬ ê³µìœ </span>
            </button>
        </div>
    </div>

    <script>
        // --- ì„¤ì • ë° ë°ì´í„° ---
        const THIS_YEAR = new Date().getFullYear();
        const NEXT_YEAR = THIS_YEAR + 1;

        const categories = [
            { label: "--- PART 1. ì·¨í–¥ê³¼ ì¦ê±°ì›€ ---", value: "" },
            { label: "ğŸµ [ìŒì•…] ì˜¬í•´ì˜ ë…¸ë™ìš” (BGM)", value: "ğŸµ ì˜¬í•´ì˜ ë…¸ë˜" },
            { label: "ğŸ“º [ì˜ìƒ] ì˜¬í•´ì˜ ì˜ìƒ (ìœ íŠœë¸Œ/ë„·í”Œë¦­ìŠ¤)", value: "ğŸ“º ì˜¬í•´ì˜ ì˜ìƒ" },
            { label: "ğŸ” [ìŒì‹] ì˜¬í•´ì˜ ë©”ë‰´ (ê¸‰ì‹/ë°°ë‹¬)", value: "ğŸ” ì˜¬í•´ì˜ ë©”ë‰´" },
            { label: "ğŸ® [ê²Œì„] ì˜¬í•´ì˜ ê²Œì„ (í”Œë ˆì´íƒ€ì„ 1ìœ„)", value: "ğŸ® ì˜¬í•´ì˜ ê²Œì„" },
            { label: "ğŸ’˜ [ë•ì§ˆ] ì˜¬í•´ì˜ ìµœì•  (ì•„ì´ëŒ/ìºë¦­í„°)", value: "ğŸ’˜ ì˜¬í•´ì˜ ìµœì• " },
            { label: "ğŸ‘— [íŒ¨ì…˜] ì˜¬í•´ì˜ OOTD", value: "ğŸ‘— ì˜¬í•´ì˜ OOTD" },
            { label: "--- PART 2. ì¼ìƒì˜ ë°ì´í„° ---", value: "" },
            { label: "ğŸ“ [ì¥ì†Œ] ì˜¬í•´ì˜ í•«í”Œë ˆì´ìŠ¤", value: "ğŸ“ ì˜¬í•´ì˜ í•«í”Œ" },
            { label: "ğŸ’¸ [ì†Œë¹„] ì˜¬í•´ì˜ ì§€ë¦„ì‹  (ì˜ ì‚° ë¬¼ê±´)", value: "ğŸ’¸ ì˜¬í•´ì˜ ì§€ë¦„ì‹ " },
            { label: "ğŸ¤¦â€â™€ï¸ [í›„íšŒ] ì˜¬í•´ì˜ ë‚­ë¹„ (ëˆ ì•„ê¹Œì›Œ)", value: "ğŸ¤¦â€â™€ï¸ ì˜¬í•´ì˜ ë‚­ë¹„" },
            { label: "ğŸ” [ê²€ìƒ‰] ì˜¬í•´ì˜ ìµœë‹¤ ê²€ìƒ‰ì–´", value: "ğŸ” ìµœë‹¤ ê²€ìƒ‰ì–´" },
            { label: "ğŸ—£ï¸ [ì–¸ì–´] ì˜¬í•´ì˜ ìœ í–‰ì–´ (ë‚´ ì…ë²„ë¦‡)", value: "ğŸ—£ï¸ ë‚˜ì˜ ìœ í–‰ì–´" },
            { label: "ğŸ«  [í‘œì •] ì˜¬í•´ì˜ ì´ëª¨ì§€ (Emoji)", value: "ğŸ«  ì˜¬í•´ì˜ ì´ëª¨ì§€" },
            { label: "--- PART 3. ê¸°ì–µì˜ ì¥ë©´ë“¤ ---", value: "" },
            { label: "â³ [ì‹œê°„] ì˜¬í•´ì˜ ìˆœì‚­ íƒ€ì„ (ëª°ì…)", value: "â³ ìˆœì‚­ëœ ì‹œê°„" },
            { label: "ğŸ¤£ [ì›ƒìŒ] ì˜¬í•´ì˜ ë°•ì¥ëŒ€ì†Œ", value: "ğŸ¤£ ë°•ì¥ëŒ€ì†Œ" },
            { label: "ğŸï¸ [í’ê²½] ì˜¬í•´ì˜ ëª…ì¥ë©´", value: "ğŸï¸ ì˜¬í•´ì˜ í’ê²½" },
            { label: "ğŸ¦¶ [í‘ì—­ì‚¬] ì˜¬í•´ì˜ ì´ë¶ˆí‚¥", value: "ğŸ¦¶ ì´ë¶ˆí‚¥ ìˆœê°„" },
            { label: "ğŸ€ [ê²½í—˜] ì˜¬í•´ì˜ ìƒˆì˜¹ì§€ë§ˆ (ì˜¤íˆë ¤ ì¢‹ì•„)", value: "ğŸ€ ì˜¤íˆë ¤ ì¢‹ì•„" },
            { label: "--- PART 4. ì‚¬ëŒê³¼ ì˜¨ê¸° ---", value: "" },
            { label: "ğŸ¦¸â€â™€ï¸ [ì¸ë¬¼] ì˜¬í•´ì˜ ê·€ì¸ (ê³ ë§ˆìš´ ì‚¬ëŒ)", value: "ğŸ¦¸â€â™€ï¸ ì˜¬í•´ì˜ ê·€ì¸" },
            { label: "ğŸ¤ [ì¸ì—°] ì˜¬í•´ì˜ ì†Œì¤‘í•œ ë§Œë‚¨", value: "ğŸ¤ ì†Œì¤‘í•œ ë§Œë‚¨" },
            { label: "ğŸ’Š [ìœ„ë¡œ] ì˜¬í•´ì˜ í•œ ë§ˆë”” (ë§/ê°€ì‚¬)", value: "ğŸ’Š ë‚˜ë¥¼ ì‚´ë¦° ë§" },
            { label: "ğŸ’Œ [ê°ì‚¬] ì „í•˜ê³  ì‹¶ì€ ì§„ì‹¬", value: "ğŸ’Œ ê¼­ ì „í•˜ê³  ì‹¶ì€ ë§" },
            { label: "--- PART 5. ì„±ì¥ê³¼ ë‚˜ ---", value: "" },
            { label: "ğŸ“š [ë…ì„œ] ì˜¬í•´ì˜ ì±…/ë¬¸ì¥", value: "ğŸ“š ì˜¬í•´ì˜ ë¬¸ì¥" },
            { label: "ğŸ’¯ [ê³µë¶€] ì˜¬í•´ì˜ í•™ì—… ì„±ì·¨", value: "ğŸ’¯ í•™ì—… ì„±ì·¨" },
            { label: "ğŸ”¥ [ë„ì „] ì˜¬í•´ì˜ ìš©ê¸° (ìƒˆë¡œìš´ ì‹œë„)", value: "ğŸ”¥ ì˜¬í•´ì˜ ë„ì „" },
            { label: "âœ¨ [ëŠ¥ë ¥] ì˜¬í•´ì˜ ì¬ëŠ¥ ë°œê²¬", value: "âœ¨ ìˆ¨ê²¨ì§„ ì¬ëŠ¥" },
            { label: "ğŸ¦‹ [ë³€í™”] ì˜¬í•´ì˜ ë‹¬ë¼ì§„ ì ", value: "ğŸ¦‹ ë‹¬ë¼ì§„ ë‚´ ëª¨ìŠµ" },
            { label: "ğŸ‘ [ì¹­ì°¬] ì˜¬í•´ì˜ ë©‹ì§„ ë‚˜", value: "ğŸ‘ ì•„ì£¼ ì¹­ì°¬í•´" },
            { label: "--- PART 6. ë‹¤ìŒ ì±•í„° ---", value: "" },
            { label: "â˜ƒï¸ [ì„¤ë ˜] ë‹¤ê°€ì˜¬ ê²¨ìš¸ë°©í•™ ê³„íš", value: "â˜ƒï¸ ê²¨ìš¸ë°©í•™ ê³„íš" },
            { label: `ğŸ¯ [ëª©í‘œ] ${NEXT_YEAR}ë…„ í•µì‹¬ ëª©í‘œ`, value: `ğŸ¯ ${NEXT_YEAR}ë…„ ëª©í‘œ` },
            { label: "ğŸ“® [í¸ì§€] ë¯¸ë˜ì˜ ë‚˜ì—ê²Œ í•œ ë§ˆë””", value: "ğŸ“® ë¯¸ë˜ì˜ ë‚˜ì—ê²Œ" }
        ];

        // ë™ì  ëª…ì–¸ (ë…„ë„ ë°˜ì˜)
        const quotes = [
            `"ê¸°ì–µí•˜ì§€ ì•Šìœ¼ë©´ ì‹œê°„ì€ ì‚¬ë¼ì§€ì§€ë§Œ,\nê¸°ë¡í•˜ë©´ ì˜ì›ì´ ëœë‹¤."`,
            `"ë„ˆì˜ ${THIS_YEAR}ë…„, ì°¸ ì• ì¼ë‹¤.\n${NEXT_YEAR}ë…„ì€ ë” ëˆˆë¶€ì‹¤ ê±°ì•¼."`,
            `"ì§€ë‚˜ê°„ ì‹œê°„ì€ ì¶”ì–µì´ê³ ,\në‹¤ê°€ì˜¬ ì‹œê°„ì€ ì„ ë¬¼ì´ë‹¤."`,
            `"ê°€ì¥ ì¢‹ì€ ë‚ ì€ ì•„ì§ ì˜¤ì§€ ì•Šì•˜ë‹¤.\në„ˆì˜ ${NEXT_YEAR}ë…„ì„ ê¸°ëŒ€í•´."`,
            `"ë„ˆë¼ëŠ” ì±…ì˜ ${THIS_YEAR}ë…„ ì±•í„°,\ní•´í”¼ì—”ë”©ìœ¼ë¡œ ê²°ì œ ì™„ë£Œ."`,
            `"í”ë“¤ë¦¬ì§€ ì•Šê³  í”¼ëŠ” ê½ƒì´ ì–´ë”” ìˆìœ¼ë´.\nì˜ ìëë‹¤, ë„ˆë¼ëŠ” ê½ƒ."`,
            `"ì˜¤ëŠ˜ì„ ê¸°ì–µí•´,\nìš°ë¦¬ëŠ” ì„œë¡œì˜ ìš©ê¸°ì˜€ìœ¼ë‹ˆê¹Œ."`,
            `"ì˜¤ì§€ ì•Šì€ ë‚ ë“¤ì„ ê¸°ì˜ê²Œ ë§ì´í•˜ëŠ” ê²ƒì´\nì§€ë‚œë‚ ì— ëŒ€í•œ ì˜ˆì˜ë‹¤."`,
            `"ë„ˆì˜ ëª¨ë“  ê³„ì ˆì´ ì•„ë¦„ë‹¤ì› ë‹¤.\në‹¤ê°€ì˜¬ ë´„ë„ ê·¸ëŸ´ ê²ƒì´ë‹¤."`,
            `"ì´ ì˜ìˆ˜ì¦ì€ í™˜ë¶ˆ ë¶ˆê°€.\nëŒ€ì‹  'í¬ë§'ìœ¼ë¡œ êµí™˜í•´ ë“œë¦½ë‹ˆë‹¤."`,
            `"ë³„ì²˜ëŸ¼ ë¹›ë‚˜ë˜ ìˆœê°„ë“¤ì´ ëª¨ì—¬\në„ˆë¼ëŠ” ìš°ì£¼ê°€ ë˜ì—ˆë‹¤."`,
            `"${THIS_YEAR}ë…„ ê²°ì‚° ì™„ë£Œ.\në‹¹ì‹ ì˜ ì°¬ë€í•œ ${NEXT_YEAR}ë…„ì„ ì‘ì›í•©ë‹ˆë‹¤."`,
            `"ëª¨ë“  ìˆœê°„ì´ ë„ˆì˜€ë‹¤.\në°˜ì§ì˜€ë˜ ë„ˆì˜ ${THIS_YEAR}ë…„."`,
            `"ëì€ ë˜ ë‹¤ë¥¸ ì‹œì‘ì˜ ì´ë¦„ì´ë‹¤.\në©‹ì§„ ì—¬í–‰ì„ ê³„ì†í•˜ì."`,
            `"ì•ˆë…•ì€ ì˜ì›í•œ í—¤ì–´ì§ì´ ì•„ë‹ˆê² ì§€ìš”.\në‹¤ì‹œ ë§Œë‚˜ì, ë‚˜ì˜ ${NEXT_YEAR}."`
        ];

        // --- ì´ˆê¸°í™” ---
        window.onload = function() {
            updateYears();
            createInputFields();
        };

        // --- í•¨ìˆ˜ ì •ì˜ ---
        function createInputFields() {
            const container = document.getElementById('inputContainer');
            for (let i = 1; i <= 12; i++) {
                const div = document.createElement('div');
                div.className = "bg-white p-4 rounded-xl border-2 border-transparent hover:border-[#2C405E] transition-all duration-200 shadow-sm";
                
                let optionsHtml = `<option value="">ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”.</option>`;
                categories.forEach(cat => {
                    if(cat.value === "") {
                        optionsHtml += `<option disabled class="bg-gray-100 text-gray-500">â”€â”€ ${cat.label.replace(/-/g, '')} â”€â”€</option>`;
                    } else {
                        optionsHtml += `<option value="${cat.value}">${cat.label}</option>`;
                    }
                });

                div.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-[#2C405E] text-white text-[12px] font-bold px-2 py-1 rounded-full w-8 text-center flex-shrink-0">#${i}</span>
                        <select id="topic${i}" class="flex-grow bg-transparent text-sm font-bold text-gray-700 outline-none cursor-pointer overflow-hidden text-ellipsis whitespace-nowrap">
                            ${optionsHtml}
                        </select>
                    </div>
                    <input type="text" id="desc${i}" class="w-full bg-[#f3f4f6] border border-gray-200 rounded p-2 text-sm outline-none focus:bg-white focus:border-[#2C405E] transition placeholder-gray-400" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">
                `;
                container.appendChild(div);
            }
        }

        function updateYears() {
            document.title = `${THIS_YEAR} ì—°ë§ ê¸°ì–µ ì˜ìˆ˜ì¦`;
            const currentYearSpans = document.querySelectorAll('.current-year-text');
            currentYearSpans.forEach(span => span.innerText = THIS_YEAR);
            const nextYearSpans = document.querySelectorAll('.next-year-text');
            nextYearSpans.forEach(span => span.innerText = NEXT_YEAR);
        }

        function startIssueProcess() {
            document.getElementById('inputScreen').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');
            document.getElementById('loadingScreen').classList.add('flex');

            setTimeout(() => { document.getElementById('progressBar').style.width = '100%'; }, 100);
            setTimeout(() => { document.getElementById('loadingMsg2').classList.remove('opacity-0'); }, 1200);
            setTimeout(() => { document.getElementById('loadingMsg3').classList.remove('opacity-0'); }, 2500);

            generateReceiptData();

            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('loadingScreen').classList.remove('flex');
                document.getElementById('resultScreen').classList.remove('hidden');
                document.getElementById('resultScreen').classList.add('flex');
                
                const captureArea = document.getElementById('captureArea');
                captureArea.classList.remove('print-animation');
                void captureArea.offsetWidth;
                captureArea.classList.add('print-animation');
            }, 4000);
        }

        function goBack() {
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('flex');
            document.getElementById('inputScreen').classList.remove('hidden');
            
            document.getElementById('progressBar').style.width = '0';
            document.getElementById('loadingMsg2').classList.add('opacity-0');
            document.getElementById('loadingMsg3').classList.add('opacity-0');
            document.getElementById('captureArea').classList.remove('print-animation');
        }

        function generateReceiptData() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            
            document.getElementById('receiptDate').innerText = `${year}.${month}.${day}`;

            const name = document.getElementById('issuerName').value;
            document.getElementById('viewName').innerText = name ? name : "GUEST";

            const randomIndex = Math.floor(Math.random() * quotes.length);
            document.getElementById('quoteArea').innerHTML = quotes[randomIndex].replace(/\n/g, '<br>');

            const listContainer = document.getElementById('receiptList');
            listContainer.innerHTML = '';
            
            let count = 0;

            for (let i = 1; i <= 12; i++) {
                const topicElem = document.getElementById(`topic${i}`);
                const descElem = document.getElementById(`desc${i}`);
                
                if (topicElem && descElem) {
                    const topic = topicElem.value;
                    const desc = descElem.value;

                    if (topic !== "" && desc.trim() !== "") {
                        count++;
                        const row = document.createElement('div');
                        row.className = "flex justify-between items-start mb-2";
                        row.innerHTML = `
                            <div class="w-[45%] text-[11px] font-bold text-gray-800 pt-0.5 leading-tight tracking-tight break-keep">${topic}</div>
                            <div class="w-[55%] text-right text-sm leading-snug font-medium break-keep text-black font-receipt">${desc}</div>
                        `;
                        listContainer.appendChild(row);
                    }
                }
            }
            document.getElementById('totalCount').innerText = count;

            if (count === 0) {
                listContainer.innerHTML = `
                    <div class="text-center text-gray-400 py-20 text-xs">
                        <i class="fas fa-arrow-left mb-2"></i><br>
                        ê¸°ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.<br>'ìˆ˜ì •í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }

            // ë°”ì½”ë“œ ìƒì„± (ì•ˆì •ì„± í™•ë³´)
            try {
                JsBarcode("#barcodeSVG", "HAPPY NEW YEAR", {
                    format: "CODE128",
                    lineColor: "#374151",
                    width: 1.5,
                    height: 40,
                    displayValue: false,
                    margin: 0
                });
            } catch (e) {
                console.error("ë°”ì½”ë“œ ìƒì„± ì‹¤íŒ¨:", e);
            }
        }

        function downloadImage() {
            const captureArea = document.getElementById('captureArea');
            captureArea.classList.remove('print-animation');
            
            html2canvas(captureArea, { scale: 3, backgroundColor: null, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = `${THIS_YEAR}_ê¸°ì–µì˜ìˆ˜ì¦.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // --- â˜… ë§í¬ ê³µìœ  ê¸°ëŠ¥ (ë‹¨ì¶• URL ì ìš©) ---
        async function shareLink() {
            const shareUrl = "https://joo.is/yearbill"; // ìš”ì²­í•˜ì‹  ë‹¨ì¶• URL

            const shareData = {
                title: 'ì—°ë§ ê¸°ì–µ ì˜ìˆ˜ì¦',
                text: `${THIS_YEAR}ë…„ ì¶”ì–µì„ ì˜ìˆ˜ì¦ìœ¼ë¡œ ì •ë¦¬í•´ë³´ì„¸ìš”! ğŸ§¾`,
                url: shareUrl 
            };

            // ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ ê³µìœ  (ì¹´ì¹´ì˜¤í†¡, ë¬¸ì ë“±) ì§€ì› ì‹œ
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    console.log('ê³µìœ  ì·¨ì†Œë¨');
                }
            } else {
                // PC ë“± ì§€ì›í•˜ì§€ ì•Šì„ ê²½ìš° í´ë¦½ë³´ë“œ ë³µì‚¬
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = shareUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert("ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! \nì¹œêµ¬ë“¤ì—ê²Œ ë¶™ì—¬ë„£ê¸°(Ctrl+V)í•´ì„œ ì•Œë ¤ì£¼ì„¸ìš”.");
                } catch (err) {
                    alert("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ì„ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
                }
            }
        }
    </script>
</body>
</html>
